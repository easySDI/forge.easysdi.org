{"issue":{"id":1148,"project":{"id":16,"name":"easySDI"},"tracker":{"id":3,"name":"Enhancement"},"status":{"id":10,"name":"Closed"},"priority":{"id":4,"name":"Normal"},"author":{"id":383,"name":"Blatti Yves"},"assigned_to":{"id":761,"name":"Battaglia Marc"},"category":{"id":20,"name":"SHOP"},"fixed_version":{"id":177,"name":"4.4.0"},"subject":"SHOP enhance mail notifications","description":"In V4 notifications have been simplified (many fields have been removed compared to V2).\r\n\r\nSome of the fields in mails are important for users, validators and suppliers.\r\n\r\nHere are the *needs of ASIT VD for notifications* as an example, elements in %{color:green}green% are present in the V4 mails:\r\n\r\n\r\n|_.item/event          |_.recipient (note)       |_.mail subject              |_.mail body                                |\r\n|new order             |user (order created)     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%                  |\r\n|new order             |extraction responsible   |id_order\r\n                                                  client_org_name             |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|new order             |notified users           |id_order\r\n                                                  client_org_name\r\n                                                  *note(2)*                   |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|partial response\r\n (first product ready)\r\n see #1136             |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|final response\r\n (order_completed)     |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|new order validation  |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation done       |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected   |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected\r\n (*does not exists,\r\n see #1146*)            |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                                direct_access_order *(3)*                |\r\n|supplier rejected\r\n (when all products are\r\n rejected by supplier)  |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               direct_access_order *(3)*                 |\r\n\r\nTable notes:\r\n1) See #1150 group by suppliers\r\n2) This mail subject has currently no specific string (it's the same as the one for the extrection manager)\r\n3) This doesn't exist yet, and should be secured by unique token\r\n4) This link exists but is not secured by token, if a user knows the id of the validator he can validates his own order : #1147\r\n\r\n\r\nh2. Problem :\r\n\r\nThe current mailing system uses @sprintf@ mechanism, it results in a limitation of fields usable and their order.\r\nFor example:\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '%s' has been sent. \\n\\n You can view it in your account on http://myeasysdi.org \\n\\n My EasySDI\"\r\n</pre>\r\n\r\nh2. Solution proposal :\r\n\r\nWe could introduce a tag replacement system, with all elements of an order.\r\nWe can then pass the type of notification and an order id to the new mailer system.\r\nFor example the previous string could become:\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http://myeasysdi.org \\n\\n My EasySDI\"\r\n</pre>\r\nEasySDI admins could then override the strings in joomla and for example change it to :\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order {ORDERID} name '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http://mysite.ch \\n\\n My site admins\"\r\n</pre>\r\n\r\nh2. Notes :\r\n\r\n* We should use this change to correct some easySDI defects: #1136, #1146 and #1147\r\n* To avoid breaking previous versions of easysdi (4.2.x), we should introduce new strings for mail, but keep the content (except if )\r\n* This string mechanism should be applied to Subject and Body of the mails.\r\n* This mechanism will have to be documented in the wiki for admins","start_date":"2015-09-24","done_ratio":100,"custom_fields":[{"id":3,"name":"Sponsor","multiple":true,"value":[]},{"id":4,"name":"Functional impact","value":"For admins : ability to have more customizable notifications, use any order fields in any Subject or Body of notification mails."},{"id":5,"name":"Ergonomic impact","value":"for users : better notifications"}],"created_on":"2015-09-24T09:00:10Z","updated_on":"2016-02-02T14:53:39Z","closed_on":"2016-02-02T14:53:39Z","journals":[{"id":6524,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-09-25T07:04:00Z","details":[{"property":"attr","name":"description","old_value":"In V4 notifications have been simplified (many fields have been removed compared to V2).\r\n\r\nSome of the fields in mails are important for users, validators and suppliers.\r\n\r\nHere are the *needs of ASIT VD for notifications* as an example, elements in %{color:green}green% are present in the V4 mails:\r\n\r\n\r\n|_.item/event          |_.recipient (note)       |_.mail subject              |_.mail body                                |\r\n|new order             |user (order created)     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%                  |\r\n|new order             |extraction responsible   |id_order\r\n                                                  client_org_name             |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|new order             |notified users           |id_order\r\n                                                  client_org_name\r\n                                                  *note(2)*                   |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|partial response\r\n (first product ready)\r\n see #1136             |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|final response\r\n (order_completed)     |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|new order validation  |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation done       |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected   |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected\r\n (*does not exists,\r\n see #1146*)            |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                                direct_access_order *(3)*                |\r\n|supplier rejected\r\n (when all products are\r\n rejected by supplier)  |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               direct_access_order *(3)*                 |\r\n\r\nTable notes:\r\n1) How should we format a list for text mails ? I see that easySDI sometimes send html content. Can we sent <li><ul> elements ?\r\n2) This mail subject has currently no specific string (it's the same as the one for the extrection manager)\r\n3) This doesn't exist yet, and should be secured by unique token\r\n4) This link exists but is not secured by token, if a user knows the id of the validator he can validates his own order : #1147\r\n\r\n\r\nh2. Problem :\r\n\r\nThe current mailing system uses @sprintf@ mechanism, it results in a limitation of fields usable and their order.\r\nFor example:\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '%s' has been sent. \\n\\n You can view it in your account on http://myeasysdi.org \\n\\n My EasySDI\"\r\n</pre>\r\n\r\nh2. Solution proposal :\r\n\r\nWe could introduce a tag replacement system, with all elements of an order.\r\nWe can then pass the type of notification and an order id to the new mailer system.\r\nFor example the previous string could become:\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http://myeasysdi.org \\n\\n My EasySDI\"\r\n</pre>\r\nEasySDI admins could then override the strings in joomla and for example change it to :\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order {ORDERID} name '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http://mysite.ch \\n\\n My site admins\"\r\n</pre>\r\n\r\nh2. Notes :\r\n\r\n* We should use this change to correct some easySDI defects: #1136, #1146 and #1147\r\n* To avoid breaking previous versions of easysdi (4.2.x), we should introduce new strings for mail, but keep the content (except if )\r\n* This string mechanism should be applied to Subject and Body of the mails.\r\n* This mechanism will have to be documented in the wiki for admins","new_value":"In V4 notifications have been simplified (many fields have been removed compared to V2).\r\n\r\nSome of the fields in mails are important for users, validators and suppliers.\r\n\r\nHere are the *needs of ASIT VD for notifications* as an example, elements in %{color:green}green% are present in the V4 mails:\r\n\r\n\r\n|_.item/event          |_.recipient (note)       |_.mail subject              |_.mail body                                |\r\n|new order             |user (order created)     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%                  |\r\n|new order             |extraction responsible   |id_order\r\n                                                  client_org_name             |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|new order             |notified users           |id_order\r\n                                                  client_org_name\r\n                                                  *note(2)*                   |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|partial response\r\n (first product ready)\r\n see #1136             |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|final response\r\n (order_completed)     |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|new order validation  |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation done       |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected   |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected\r\n (*does not exists,\r\n see #1146*)            |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                                direct_access_order *(3)*                |\r\n|supplier rejected\r\n (when all products are\r\n rejected by supplier)  |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               direct_access_order *(3)*                 |\r\n\r\nTable notes:\r\n1) See #1150 group by suppliers\r\n2) This mail subject has currently no specific string (it's the same as the one for the extrection manager)\r\n3) This doesn't exist yet, and should be secured by unique token\r\n4) This link exists but is not secured by token, if a user knows the id of the validator he can validates his own order : #1147\r\n\r\n\r\nh2. Problem :\r\n\r\nThe current mailing system uses @sprintf@ mechanism, it results in a limitation of fields usable and their order.\r\nFor example:\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '%s' has been sent. \\n\\n You can view it in your account on http://myeasysdi.org \\n\\n My EasySDI\"\r\n</pre>\r\n\r\nh2. Solution proposal :\r\n\r\nWe could introduce a tag replacement system, with all elements of an order.\r\nWe can then pass the type of notification and an order id to the new mailer system.\r\nFor example the previous string could become:\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http://myeasysdi.org \\n\\n My EasySDI\"\r\n</pre>\r\nEasySDI admins could then override the strings in joomla and for example change it to :\r\n<pre>\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order {ORDERID} name '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http://mysite.ch \\n\\n My site admins\"\r\n</pre>\r\n\r\nh2. Notes :\r\n\r\n* We should use this change to correct some easySDI defects: #1136, #1146 and #1147\r\n* To avoid breaking previous versions of easysdi (4.2.x), we should introduce new strings for mail, but keep the content (except if )\r\n* This string mechanism should be applied to Subject and Body of the mails.\r\n* This mechanism will have to be documented in the wiki for admins"}]},{"id":6539,"user":{"id":383,"name":"Blatti Yves"},"notes":"Note TP: Direct access link without token auth should be proposed as an alternative.","created_on":"2015-09-28T12:58:16Z","details":[]},{"id":6540,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"TC has validated such enhancement.\r\n\r\n","created_on":"2015-09-28T13:00:10Z","details":[{"property":"attr","name":"status_id","old_value":"7","new_value":"9"},{"property":"attr","name":"assigned_to_id","old_value":"762","new_value":"383"}]},{"id":6979,"user":{"id":383,"name":"Blatti Yves"},"notes":"rev 9372","created_on":"2015-12-22T15:33:50Z","details":[]},{"id":6981,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T15:34:16Z","details":[{"property":"relation","name":"relates","new_value":"1150"}]},{"id":6983,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T15:34:22Z","details":[{"property":"relation","name":"relates","new_value":"1147"}]},{"id":6985,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T15:34:28Z","details":[{"property":"relation","name":"relates","new_value":"1146"}]},{"id":6987,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T15:34:32Z","details":[{"property":"relation","name":"relates","new_value":"1136"}]},{"id":6988,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T15:36:17Z","details":[{"property":"attr","name":"status_id","old_value":"9","new_value":"2"}]},{"id":6989,"user":{"id":383,"name":"Blatti Yves"},"notes":"rev 9383","created_on":"2015-12-22T15:36:25Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"},{"property":"attr","name":"done_ratio","old_value":"0","new_value":"100"}]},{"id":6996,"user":{"id":383,"name":"Blatti Yves"},"notes":"Documentation ready : https://forge.easysdi.org/projects/easysdi/wiki/4_SHOP_emails_customization","created_on":"2015-12-22T15:38:19Z","details":[]},{"id":6997,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T16:02:17Z","details":[{"property":"relation","name":"relates","new_value":"1192"}]},{"id":7069,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2016-02-02T09:50:11Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"12"}]},{"id":7090,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2016-02-02T09:53:11Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"761"}]},{"id":7110,"user":{"id":761,"name":"Battaglia Marc"},"created_on":"2016-02-02T14:52:23Z","details":[{"property":"attr","name":"fixed_version_id","new_value":"177"}]},{"id":7121,"user":{"id":761,"name":"Battaglia Marc"},"created_on":"2016-02-02T14:53:39Z","details":[{"property":"attr","name":"status_id","old_value":"12","new_value":"10"}]}]}}