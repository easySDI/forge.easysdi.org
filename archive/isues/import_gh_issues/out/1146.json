{"issue":{"id":1146,"project":{"id":16,"name":"easySDI"},"tracker":{"id":1,"name":"Defect"},"status":{"id":10,"name":"Closed"},"priority":{"id":4,"name":"Normal"},"author":{"id":383,"name":"Blatti Yves"},"assigned_to":{"id":761,"name":"Battaglia Marc"},"category":{"id":20,"name":"SHOP"},"fixed_version":{"id":177,"name":"4.4.0"},"subject":"Wrong notification sent in case of rejection third party","description":"Wrong notification sent in case of rejection third party\r\nThe content if the \"new order\" mail.\r\n\r\n\\joomla\\components\\com_easysdi_shop\\models\\order.php\r\n<pre>\r\n<code class=\"php\">\r\n    /**\r\n     * thirdpartyRejection - rejection of an order by a thirdparty\r\n     * \r\n     * @param integer $id\r\n     * @param mixed $reason - defined as optional but $reason have to be set !\r\n     * @return boolean\r\n     * @since 4.3.0\r\n     */\r\n    public function thirdpartyRejection($id, $reason=null){\r\n        $id = (!empty($id)) ? $id : (int) $this->getState('order.id');\r\n        $table = $this->getTable();\r\n        if(!$table->load($id) || is_null($reason)){\r\n            return false;\r\n        }\r\n        \r\n        $table->orderstate_id = Easysdi_shopHelper::ORDERSTATE_REJECTED;\r\n        $table->validated = false;\r\n        $table->validated_date = date('Y-m-d H:i:s');\r\n        $table->validated_reason = $reason;\r\n        \r\n        if(($orderStored = $table->store()) === true){\r\n            $db = JFactory::getDbo();\r\n            $query = $db->getQuery(true)\r\n                    ->update('#__sdi_order_diffusion')\r\n                    ->set('productstate_id='.Easysdi_shopHelper::PRODUCTSTATE_REJECTED_TP)\r\n                    ->where('order_id = ' . (int)$id);\r\n            $db->setQuery($query);\r\n            $db->execute();\r\n            \r\n            // Notify customer\r\n            Easysdi_shopHelper::notifyCustomer($table->name);\r\n        }\r\n        \r\n        return $orderStored;\r\n    }\r\n</code>\r\n</pre>","start_date":"2015-09-24","done_ratio":100,"custom_fields":[{"id":2,"name":"Affected version","value":"172"}],"created_on":"2015-09-24T07:51:45Z","updated_on":"2016-02-02T14:53:38Z","closed_on":"2016-02-02T14:53:38Z","journals":[{"id":6984,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T15:34:27Z","details":[{"property":"relation","name":"relates","new_value":"1148"}]},{"id":6994,"user":{"id":383,"name":"Blatti Yves"},"notes":"rev 9383","created_on":"2015-12-22T15:37:21Z","details":[{"property":"attr","name":"done_ratio","old_value":"0","new_value":"100"}]},{"id":6995,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-12-22T15:37:29Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"}]},{"id":7027,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2016-01-15T15:51:36Z","details":[{"property":"attr","name":"fixed_version_id","new_value":"177"}]},{"id":7067,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2016-02-02T09:50:10Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"12"}]},{"id":7088,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2016-02-02T09:53:10Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"761"}]},{"id":7119,"user":{"id":761,"name":"Battaglia Marc"},"created_on":"2016-02-02T14:53:38Z","details":[{"property":"attr","name":"status_id","old_value":"12","new_value":"10"}]}]}}