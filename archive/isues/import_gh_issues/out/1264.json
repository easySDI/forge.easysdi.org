{"issue":{"id":1264,"project":{"id":16,"name":"easySDI"},"tracker":{"id":1,"name":"Defect"},"status":{"id":10,"name":"Closed"},"priority":{"id":5,"name":"High"},"author":{"id":383,"name":"Blatti Yves"},"category":{"id":20,"name":"SHOP"},"fixed_version":{"id":179,"name":"4.4.1"},"subject":"Forbid deletion of a resource (or version) if any order in linked to the diffusion","description":"If we delete a resource having diffusion and orders attached, the deletion fails, sdi_metadata and CSW metadata are deleted but not the resources and associated tables.\r\n\r\nDeletion should not be possible.","start_date":"2016-02-15","done_ratio":100,"custom_fields":[{"id":2,"name":"Affected version","value":"138"}],"created_on":"2016-02-15T12:30:42Z","updated_on":"2016-03-31T06:18:18Z","closed_on":"2016-03-29T08:23:12Z","journals":[{"id":7242,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2016-02-19T10:47:37Z","details":[{"property":"relation","name":"relates","new_value":"1263"}]},{"id":7337,"user":{"id":383,"name":"Blatti Yves"},"notes":"I had a look at the first levels of resource's related tables.\r\nI think the only blocking tables are order and orders related (products, pricing..) tables.\r\n\r\nWe should check theses before trying to delete a resource.\r\nThe rest can be deleted by cascade.\r\n\r\n<pre>\r\n+------------+\r\n|sdi_resource|\r\n+------------+\r\n  ^\r\n  |       +---------------+\r\n  +-------+sdi_application|\r\n  |       +---------------+\r\n  |\r\n  |       +----------------------+\r\n  +-------+sdi_user_role_resource|\r\n  |       +----------------------+\r\n  |\r\n  |       +-----------+\r\n  +-------+sdi_version|\r\n          +-----------+\r\n            ^\r\n            |       +------------+\r\n            +-------+sdi_metadata|<----[CSW GN metadata]\r\n            |       +------------+          \r\n            |\r\n            |       +---------------+\r\n            +-(2X)--+sdi_versionlink|\r\n            |       +---------------+      \r\n            |\r\n            |       +-----------------+\r\n            +-------+sdi_visualization|\r\n            |       +-----------------+  \r\n            |\r\n            |       +-------------+\r\n            +-------+sdi_diffusion|\r\n                    +-------------+   \r\n                      ^\r\n                      |       +----------------------+\r\n                      +-------+sdi_diffusion_download|\r\n                      |       +----------------------+  \r\n                      |\r\n                      |       +-----------------------+\r\n                      +-------+sdi_diffusion_perimeter|\r\n                      |       +-----------------------+      \r\n                      |\r\n                      |       +--------------------------+\r\n                      +-------+sdi_diffusion_notifieduser|\r\n                      |       +--------------------------+   \r\n                      |\r\n                      |       +---------------------------+\r\n                      +-------+sdi_diffusion_propertyvalue|\r\n                      |       +---------------------------+\r\n                      |\r\n                      |       +-------------------+\r\n                      +-------+sdi_order_diffusion|<-----[child order tables]\r\n                      |       +-------------------+      \r\n                      |\r\n                      |       +----------------------------------+\r\n                      +-------+sdi_pricing_order_supplier_product|<------[pricing tree]\r\n                              +----------------------------------+                          \r\n</pre>","created_on":"2016-03-01T09:57:21Z","details":[]},{"id":7447,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2016-03-29T08:22:51Z","details":[{"property":"attr","name":"status_id","old_value":"1","new_value":"2"},{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"23"},{"property":"attr","name":"fixed_version_id","new_value":"179"}]},{"id":7448,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2016-03-29T08:23:05Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"},{"property":"attr","name":"done_ratio","old_value":"0","new_value":"100"}]},{"id":7449,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2016-03-29T08:23:12Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"10"},{"property":"attr","name":"assigned_to_id","old_value":"23"}]}]}}