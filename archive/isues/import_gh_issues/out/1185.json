{"issue":{"id":1185,"project":{"id":16,"name":"easySDI"},"tracker":{"id":1,"name":"Defect"},"status":{"id":10,"name":"Closed"},"priority":{"id":6,"name":"Urgent"},"author":{"id":383,"name":"Blatti Yves"},"category":{"id":20,"name":"SHOP"},"fixed_version":{"id":176,"name":"4.3.2"},"subject":"Estimates are sent to supplier even if pricing is defined (calculated, of free product)","description":"Estimates are sent to provider even if pricing is defined (calculated, of free product).\r\n\r\n1) If all products of the basket have a price, the 'estimate' button should not be visible.\r\n2) If SOME of the products have a pricing, but not all: the 'undefined' prices should be sent to supplier, but other should change have status to available and the order to progress","start_date":"2015-11-12","done_ratio":100,"custom_fields":[{"id":2,"name":"Affected version","value":"176"}],"created_on":"2015-11-12T09:13:56Z","updated_on":"2015-11-20T10:28:40Z","closed_on":"2015-11-20T10:28:40Z","journals":[{"id":6668,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-11-12T09:24:27Z","details":[{"property":"attr","name":"status_id","old_value":"1","new_value":"2"},{"property":"attr","name":"assigned_to_id","new_value":"383"}]},{"id":6671,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2015-11-13T08:44:56Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"23"}]},{"id":6760,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"I didn't see any problem with the \"estimate\" button : the behaviour (hide/visible) seems to be coherent with the basket content.","created_on":"2015-11-16T15:46:48Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"},{"property":"attr","name":"assigned_to_id","old_value":"23","new_value":"383"},{"property":"attr","name":"fixed_version_id","new_value":"176"},{"property":"attr","name":"done_ratio","old_value":"0","new_value":"100"}]},{"id":6765,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"Following YB informations, I've fixed the behaviour of the \"estimate\" button in the basket.","created_on":"2015-11-17T10:56:07Z","details":[]},{"id":6779,"user":{"id":383,"name":"Blatti Yves"},"notes":"\"estimate\" button works now, thanks.\r\n\r\nFor the products sent to suppliers, there is one case not taken into account:\r\nWhen an order is a draft, with some 'fee without pricing profile' diffusions, if one of these has been set to 0 (for example on product is internal), both are send to their suppliers.\r\nThis problem is not present if only one supplier is present.\r\n\r\nTest is done with _ordertype + pricing type_, but this is not sufficient for the 'fee without profile' that may have a price.\r\n\r\n<pre>\r\n                switch ($table->ordertype_id):\r\n                    case Easysdi_shopHelper::ORDERTYPE_ESTIMATE: //Some diffusions may already have an estimation (free or with an automatic profile)\r\n                        if ($diffusion->pricing == Easysdi_shopHelper::PRICING_FEE_WITHOUT_PROFILE):\r\n                            $od['productstate_id'] = Easysdi_shopHelper::PRODUCTSTATE_SENT;                            \r\n                        else:\r\n                            $od['productstate_id'] = Easysdi_shopHelper::PRODUCTSTATE_AVAILABLE;\r\n                            $count_available++;\r\n                        endif;\r\n                        break;\r\n                    case Easysdi_shopHelper::ORDERTYPE_DRAFT: //Set a state await for a draft\r\n                        $od['productstate_id'] = Easysdi_shopHelper::PRODUCTSTATE_AWAIT;\r\n                        break;\r\n                    case Easysdi_shopHelper::ORDERTYPE_ORDER: //\r\n                        $od['productstate_id'] = ($table->orderstate_id == Easysdi_shopHelper::ORDERSTATE_VALIDATION) ? Easysdi_shopHelper::PRODUCTSTATE_VALIDATION : Easysdi_shopHelper::PRODUCTSTATE_SENT;\r\n                        break;\r\n                endswitch;\r\n</pre>\r\n\r\nSee:\r\n!pricing.png!","created_on":"2015-11-18T13:07:10Z","details":[{"property":"attachment","name":"956","new_value":"pricing.png"},{"property":"attr","name":"status_id","old_value":"3","new_value":"2"},{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"23"},{"property":"attr","name":"done_ratio","old_value":"100","new_value":"90"}]},{"id":6786,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2015-11-20T07:47:26Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"},{"property":"attr","name":"assigned_to_id","old_value":"23","new_value":"195"},{"property":"attr","name":"done_ratio","old_value":"90","new_value":"100"}]},{"id":6787,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2015-11-20T07:47:32Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"195","new_value":"383"}]},{"id":6788,"user":{"id":383,"name":"Blatti Yves"},"notes":"It works !! Thanks\r\n","created_on":"2015-11-20T09:33:27Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"12"},{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"23"}]},{"id":6789,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2015-11-20T10:28:40Z","details":[{"property":"attr","name":"status_id","old_value":"12","new_value":"10"},{"property":"attr","name":"assigned_to_id","old_value":"23"}]}]}}