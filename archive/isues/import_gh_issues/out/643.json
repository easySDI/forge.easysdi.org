{"issue":{"id":643,"project":{"id":16,"name":"easySDI"},"tracker":{"id":2,"name":"Feature"},"status":{"id":10,"name":"Closed"},"priority":{"id":4,"name":"Normal"},"author":{"id":9,"name":"M\u00e9rour Xavier"},"category":{"id":20,"name":"SHOP"},"fixed_version":{"id":172,"name":"4.3.0"},"subject":"add price calculation for diffusion","description":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"pricing manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"pricing manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"pricing\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Pricing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 -and the \"pricing manager\" role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the pricing manager will be able to define its entire price politic \r\nif the user can manage pricing for different organisms, the user must first choose for which organism he wants see the pricing.\r\n\r\n * first screen lists all organisms that a pricing manager is responsible for (with per organism filter); if the user is responsible of only one organism than the first screen displays automatically pricing's edition form\r\n\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a pricing profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a pricing profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all pricing information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n","start_date":"2014-03-14","done_ratio":0,"custom_fields":[{"id":3,"name":"Sponsor","multiple":true,"value":[]},{"id":4,"name":"Functional impact"},{"id":5,"name":"Ergonomic impact"}],"created_on":"2014-03-14T11:24:46Z","updated_on":"2015-09-18T15:16:56Z","closed_on":"2015-03-06T13:58:43Z","journals":[{"id":2594,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"gliffy has to be changed (basket)","created_on":"2014-03-14T11:25:17Z","details":[{"property":"attr","name":"assigned_to_id","new_value":"9"}]},{"id":2595,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"question open : tax rate (TVA) ???","created_on":"2014-03-14T12:48:04Z","details":[]},{"id":2634,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"Work on basket to do (layout proposal with Gliffy)\r\n\r\nThanks Yves.","created_on":"2014-03-21T15:01:23Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"9","new_value":"383"}]},{"id":3152,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"","created_on":"2014-04-24T12:59:21Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6)\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee wothout a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see gliffy attachement 5)\r\n-\r\n\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6)\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee wothout a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see bootstrap layout in attachement)\r\n\r\n\r\n"},{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"9"}]},{"id":3153,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"","created_on":"2014-04-24T13:27:41Z","details":[{"property":"attachment","name":"675","new_value":"2_gliffy_gestion_tarification.png"},{"property":"attachment","name":"676","new_value":"6_gliffy_tarification_backend.png"},{"property":"attachment","name":"677","new_value":"4_gliffy_webservice.png"},{"property":"attachment","name":"678","new_value":"3_gliffy_formula.png"},{"property":"attachment","name":"679","new_value":"basket4.zip"},{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6)\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee wothout a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see bootstrap layout in attachement)\r\n\r\n\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6)\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see layout in attachement)\r\n\r\n- formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n"},{"property":"attr","name":"done_ratio","old_value":"0","new_value":"10"}]},{"id":3155,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"Hi Bruno,\r\n\r\nWe completed this new feature description. Hope you have now all you need to digg in !\r\nPlease do not hesitate to write your questions here.\r\n\r\nThen we will need a vote :-)","created_on":"2014-04-24T13:35:17Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"9","new_value":"3"}]},{"id":3350,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"Hi,\n\nWe realized we should complete the description of this feature in three areas :\n\n- price calculation details (rules of rounding mainly)\n- pice details given to the third-party via WPS\n- XML structure in WPS \n\nWe get back to you !\n","created_on":"2014-05-27T13:56:54Z","details":[]},{"id":3364,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-05-30T08:11:57Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"3","new_value":"9"}]},{"id":3574,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:17:22Z","details":[{"property":"attachment","name":"676","old_value":"6_gliffy_tarification_backend.png"}]},{"id":3575,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:17:49Z","details":[{"property":"attachment","name":"721","new_value":"6_gliffy_tarification_backend.png"}]},{"id":3576,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:18:51Z","details":[{"property":"attachment","name":"678","old_value":"3_gliffy_formula.png"}]},{"id":3577,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:19:07Z","details":[{"property":"attachment","name":"722","new_value":"3_gliffy_formula.png"}]},{"id":3578,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:19:48Z","details":[{"property":"attachment","name":"679","old_value":"basket4.zip"}]},{"id":3579,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:20:17Z","details":[{"property":"attachment","name":"723","new_value":"basket5.zip"}]},{"id":3580,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:22:50Z","details":[{"property":"attachment","name":"724","new_value":"new_basket_explain.png"}]},{"id":3581,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:27:24Z","details":[{"property":"attachment","name":"724","old_value":"new_basket_explain.png"}]},{"id":3582,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-25T14:27:36Z","details":[{"property":"attachment","name":"725","new_value":"new_basket_explain.png"}]},{"id":3583,"user":{"id":383,"name":"Blatti Yves"},"notes":"Pseudo-code for price calculation (with pricing profile) of an item in basket:\r\n\r\n<pre>\r\n<code class=\"php\">\r\n//$diffusion represents the \"product\" (jos_sdi_diffusion) and linked properties like princing profile\r\n//$order represents the order, with the client, third party the surface...\r\n//$config is shop configuration\r\n//$provider is the organism that provides the product (diffusion)\r\n//$provider.princing is the configuration of pricing at organism level\r\n\r\n$priceExclTaxes = 0;\r\n$finalPriceExclTaxes = 0;\r\n$finalPriceInclTaxes = 0;\r\n\r\n$floorReached = false;\r\n$ceilingReached = false;\r\n$isFreeForMyCategory = false;\r\n$freeForMyCategoryName = \"\";\r\n$hasRebateForCategory = false;\r\n$rebateForMyCategory = 0;\r\n$rebateForMyCategoryName = \"\";\r\n$isFreeInternalOrder = false;\r\n\r\n$provider = $diffusion.getOrganism();\r\n\r\n// if a third party is set, use it for pricing instead of client\r\nif($order.thirdparty != null){\r\n    $organismForPricing  = $order.thirdparty.organism;\r\n}else{\r\n    $organismForPricing  = $order.client.organism;\r\n}\r\n\r\n// if \"free for internal orders\" is set -> no pricing\r\nif( ! ($organismForPricing == $provider) && $provider.princing.doNotBillInternalOrders ){\r\n\r\n    // Test if free product by category\r\n    foreach($organismForPricing.categories[] as $categ){\r\n        if($diffusion.princingProfile.isFreeForCateg($categ)){\r\n            // Yeah product is free for this category !\r\n            $isFreeForMyCategory = true;\r\n            $freeForMyCategoryName = $categ.name;\r\n            break;\r\n        }\r\n    }\r\n    \r\n    // if product is not free for any of the (cleint/thridparty) organism category\r\n    if(!$isFreeForMyCategory){\r\n        $priceExclTaxes = $diffusion.princingProfile.fixedBasePrice\r\n                        + $diffusion.princingProfile.pricePerSurface * $order.surface;\r\n        //Adapt with ceil and floor\r\n        if ($priceExclTaxes > $diffusion.princingProfile.ceilingPrice){\r\n            $ceilingReached = true;\r\n            $priceExclTaxes = $diffusion.princingProfile.ceilingPrice;\r\n        }\r\n        if ($priceExclTaxes < $diffusion.princingProfile.floorPrice){\r\n            $floorReached = true;\r\n            $priceExclTaxes = $diffusion.princingProfile.floorPrice;\r\n        }\r\n        \r\n        //Check org. category has a rebate given by provider organism\r\n        foreach($organismForPricing.categories[] as $categ){\r\n            $reb = $provider.princing.getRebateForCateg($categ);\r\n            if($reb > $rebateForMyCategory){\r\n                $rebateForMyCategory = $reb;\r\n                $hasRebateForCategory = true;\r\n                $rebateForMyCategoryName = $categ.name;\r\n            }\r\n        }\r\n        \r\n        //Apply rebate\r\n        if($hasRebateForCategory){\r\n            $finalPriceExclTaxes = $priceExclTaxes - $priceExclTaxes * ($rebateForMyCategory / 100)\r\n        }else{\r\n            $finalPriceExclTaxes = $priceExclTaxes;\r\n        }\r\n        \r\n        //Round excl. tax price to cent\r\n        $finalPriceExclTaxes = round($finalPriceExclTaxes,2);\r\n        \r\n        //Apply VAT     \r\n        $finalPriceInclTaxes = $finalPriceExclTaxes + ($finalPriceExclTaxes * ($config.VAT / 100));\r\n    }\r\n}\r\n</code>\r\n</pre>","created_on":"2014-06-25T14:32:54Z","details":[]},{"id":3584,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-26T08:06:31Z","details":[{"property":"attachment","name":"725","old_value":"new_basket_explain.png"}]},{"id":3585,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-26T08:06:51Z","details":[{"property":"attachment","name":"726","new_value":"new_basket_explain.png"}]},{"id":3586,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-06-26T08:24:39Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6)\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see layout in attachement)\r\n\r\n- formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6)\r\n\r\n- in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" role is not available in CONTACT\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n* Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n* Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n- formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n- pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n- *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n"}]},{"id":3591,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"","created_on":"2014-06-26T09:25:46Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"9","new_value":"3"}]},{"id":3598,"user":{"id":3,"name":"Magoni Bruno"},"notes":"Thanks for voting on such feature described by Xavier...","created_on":"2014-06-26T12:42:39Z","details":[{"property":"attr","name":"status_id","old_value":"1","new_value":"11"},{"property":"attr","name":"done_ratio","old_value":"10","new_value":"0"}]},{"id":3599,"user":{"id":3,"name":"Magoni Bruno"},"notes":"+1","created_on":"2014-06-26T12:42:45Z","details":[]},{"id":3600,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"Surprisingly... it's a +1 for me ;-)","created_on":"2014-06-26T12:53:41Z","details":[]},{"id":3627,"user":{"id":777,"name":"Teixeira J\u00e9r\u00f4me"},"notes":"Ol\u00e0 amigos,\r\n+1","created_on":"2014-06-26T14:49:29Z","details":[]},{"id":3670,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-07-01T12:40:54Z","details":[{"property":"attr","name":"status_id","old_value":"11","new_value":"9"}]},{"id":3684,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-07-02T14:03:13Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6)\r\n\r\n- in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" role is not available in CONTACT\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n* Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n* Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n- formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n- pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n- *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n- in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT- assignation is not available in resource's role management\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n* Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n* Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n- formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n- pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n- *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n"}]},{"id":3685,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-07-02T14:05:34Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n* in back-end\r\n\r\n- add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n\r\n- in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n\r\n- in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n- in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT- assignation is not available in resource's role management\r\n\r\n* in front-end\r\n\r\n- a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n- in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n- basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n* Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n* Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n- formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n- pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n- *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT- assignation is not available in resource's role management\r\n\r\n*in front-end*\r\n\r\n* a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n"}]},{"id":3686,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-07-02T14:44:55Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms)\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT- assignation is not available in resource's role management\r\n\r\n*in front-end*\r\n\r\n* a new screen wher the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"tarification manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n"}]},{"id":3687,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-07-02T14:45:15Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"3","new_value":"787"}]},{"id":3689,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-07-02T14:50:28Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"tarification manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"tarification manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n * first screen lists all organisms that a tarification manager is responsible for (with per organism filter); if the user is responsible of only one organism than the first screen displays automatically tarification's edition form\r\n\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n"}]},{"id":3690,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-07-02T14:53:49Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"tarification manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"tarification manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"tarification\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Princing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"tarification manager\" -role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the tarification manager will be able to define its entire price politic \r\nif the user can manage tarification for different organisms, the user must first choose for which organism he wants see the tarification.\r\n\r\n * first screen lists all organisms that a tarification manager is responsible for (with per organism filter); if the user is responsible of only one organism than the first screen displays automatically tarification's edition form\r\n\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a tarification profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a traification profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all tarification information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"pricing manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"pricing manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"pricing\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Pricing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"pricing manager\" -role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the pricing manager will be able to define its entire price politic \r\nif the user can manage pricing for different organisms, the user must first choose for which organism he wants see the pricing.\r\n\r\n * first screen lists all organisms that a pricing manager is responsible for (with per organism filter); if the user is responsible of only one organism than the first screen displays automatically pricing's edition form\r\n\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a pricing profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a pricing profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all pricing information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n"}]},{"id":3698,"user":{"id":3,"name":"Magoni Bruno"},"created_on":"2014-07-04T15:25:50Z","details":[{"property":"attr","name":"status_id","old_value":"9","new_value":"2"}]},{"id":3776,"user":{"id":3,"name":"Magoni Bruno"},"created_on":"2014-07-17T19:09:08Z","details":[{"property":"attr","name":"fixed_version_id","new_value":"114"}]},{"id":3881,"user":{"id":3,"name":"Magoni Bruno"},"created_on":"2014-07-25T08:47:57Z","details":[{"property":"attr","name":"fixed_version_id","old_value":"114","new_value":"158"}]},{"id":3983,"user":{"id":383,"name":"Blatti Yves"},"notes":"As we discussed to create a new service instead of extending the current WPS, I have started a specification page in the wiki (as it will be used as documentation in future).\r\nThere are still many question (documented in the wiki), like how do we store perimeters of \"code/value\" type. You will also find an XML sample and an XSD schema.\r\nAny comments are welcome !\r\n\r\nYou'll find the page here: https://forge.easysdi.org/projects/easysdi/wiki/4_shop_extraction_interface","created_on":"2014-08-12T08:39:08Z","details":[]},{"id":4010,"user":{"id":383,"name":"Blatti Yves"},"notes":"XML/XSD updated in https://forge.easysdi.org/projects/easysdi/wiki/4_shop_extraction_interface.\r\nComments are welcom","created_on":"2014-08-15T09:28:25Z","details":[]},{"id":4063,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"About the getOrders part of your wiki page.\r\n\r\nAs an order can have no thirdparty, min/maxOccurs were added into the xsd to the tierce organism.\r\nI also added id and guid attributes to the tarification profile (change done also in db ^^).\r\n\r\nQuestion:\r\n - -in the xsd, the product guid is named metadataId : why not guid ?- (cf #643-41)\r\n\r\nAbout the XSD validity : $myXML->schemaValidate($yourXSD) returns TRUE - so I would say that it's ok","created_on":"2014-08-27T10:40:56Z","details":[{"property":"attachment","name":"759","new_value":"sdi-getOrders.xsd"},{"property":"attachment","name":"760","new_value":"sdi-getOrders.xsd"}]},{"id":4064,"user":{"id":9,"name":"M\u00e9rour Xavier"},"notes":"Assigned to Yves, he will answer asap.","created_on":"2014-08-27T11:40:02Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"787","new_value":"383"}]},{"id":4067,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"I made a mistake !\r\n\r\nmetadataId exposes the metadata's guid... so, to avoid any confusion, I propose the followig change to xsd:\r\n- metadataId becomes guid and exposes the product guid\r\n- product has a new children named metadata\r\n- xml and pdf are moved into metadata\r\n- metadata's id and guid are exposed as attributes\r\n<pre>\r\n    <!-- Describes the products of a supplier -->         \r\n    <xs:complexType name=\"productsType\">\r\n        <xs:sequence>\r\n            <!-- There's at least one product -->  \r\n            <xs:element name=\"product\" maxOccurs=\"unbounded\" minOccurs=\"1\">\r\n                <xs:complexType>\r\n                    <xs:sequence>\r\n                        <xs:element type=\"xs:string\" name=\"name\"/>\r\n                        <!-- Products pricing definition -->\r\n                        <xs:element xmlns:sdi=\"http://www.easysdi.org/2011/sdi\" type=\"sdi:productPricingType\" name=\"pricing\"/>\r\n                        <!-- Product properties, this element is mandatory, but my be empty if no properties are set for this product -->\r\n                        <xs:element xmlns:sdi=\"http://www.easysdi.org/2011/sdi\" type=\"sdi:productPropertiesType\" name=\"properties\"/>\r\n                        <!-- Product metadata -->\r\n                        <xs:element xmlns:sdi=\"http://www.easysdi.org/2011/sdi\" type=\"sdi:productMetadataType\" name=\"metadata\"/>\r\n                        \r\n                    </xs:sequence>\r\n                    <xs:attribute type=\"xs:integer\" name=\"id\" use=\"required\"/>\r\n                    <xs:attribute type=\"xs:string\" name=\"guid\" use=\"required\"/>\r\n                </xs:complexType>\r\n            </xs:element>\r\n        </xs:sequence>\r\n    </xs:complexType>   \r\n\r\n\t<!-- Describes the metadata of a product -->\r\n\t<xs:complexType name=\"productMetadataType\">\r\n\t\t<xs:sequence>\r\n\t\t\t<!-- XML copy of product's metadata, saved when order is placed -->\r\n\t\t\t<xs:element type=\"xs:base64Binary\" name=\"xml\"/>\r\n\t\t\t<!-- PDF copy of product's metadata, saved when order is placed -->\r\n\t\t\t<xs:element type=\"xs:base64Binary\" name=\"pdf\"/>\r\n\t\t</xs:sequence>\r\n\t\t<xs:attribute type=\"xs:integer\" name=\"id\" use=\"required\"/>\r\n\t\t<xs:attribute type=\"xs:string\" name=\"guid\" use=\"required\"/>\r\n\t</xs:complexType>\r\n</pre>\r\n\r\nBtw: I also propose to add the client's name:\r\n<pre>\r\n<!-- Describes a client (a user) -->\r\n    <xs:complexType name=\"clientType\">\r\n        <xs:sequence>\r\n            <xs:element type=\"xs:string\" name=\"name\"/>\r\n            <!-- client's addresses -->\r\n            <xs:element xmlns:sdi=\"http://www.easysdi.org/2011/sdi\" type=\"sdi:contactType\" name=\"contact\"/>\r\n            <xs:element xmlns:sdi=\"http://www.easysdi.org/2011/sdi\" type=\"sdi:invoiceType\" name=\"invoice\"/>\r\n            <xs:element xmlns:sdi=\"http://www.easysdi.org/2011/sdi\" type=\"sdi:deliveryType\" name=\"delivery\"/>\r\n            <xs:element xmlns:sdi=\"http://www.easysdi.org/2011/sdi\" type=\"sdi:organismType\" name=\"organism\"/>\r\n        </xs:sequence>\r\n        <xs:attribute type=\"xs:integer\" name=\"id\" use=\"required\"/>\r\n        <xs:attribute type=\"xs:string\" name=\"guid\" use=\"required\"/>\r\n    </xs:complexType>\r\n</pre>","created_on":"2014-08-28T14:22:25Z","details":[]},{"id":4068,"user":{"id":383,"name":"Blatti Yves"},"notes":"Looks perfect to me !\r\n\r\n- Wow infos\r\n- Such clearer\r\n!http://tof.canardpc.com/view/de063400-3ade-4aa6-98d8-11a87a841545.jpg!\r\n\r\nCan you merge your improvements in the wiki page attachments ?\r\nhttps://forge.easysdi.org/projects/easysdi/wiki/4_shop_extraction_interface","created_on":"2014-09-01T07:59:45Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"787"}]},{"id":4069,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"Update done for getOrders !\r\n\r\nAbout setOrder:\r\nwith this method, we're allowed to set only one product at once (even if order has many products) : so why not call this method *setProduct* ?\r\nif it's a remote storage, the supplier send a filename : why not if it's a local storage ?\r\nwhat is the benefit using POST instead of XML/XSD ?\r\nAfter some reflexions, we think we should use an XSD to validate the request cause:\r\n- some parameters cannot be free filed (productState ...)\r\n- an xsd validation protects us against unpredictable cases and allows a more concise/readable webservice's code\r\n- it's more consistent (for us !) to have get and set using the same philosophy","created_on":"2014-09-01T13:12:22Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"787","new_value":"383"}]},{"id":4070,"user":{"id":383,"name":"Blatti Yves"},"notes":"- name setProduct : you're totally right about this !\r\n- localStorage filename: I didn't set it as mandatory, because if we use the file post right: we set the content-disposition header with a filename (RFC:6266). But this can be discussed.\r\n- I proposed using POST mainly for sending the data as a file and not XML encoded: like this PHP can stream the file to disk, and not load it to memory. This allows us to load extra-large files (the only limits are upload size in apache and php... and disk space).\r\n- I agree that a full XML webservice would be more consistent, and \"classic\". But do we have a solution that would allow large files in XML response without blowing up server's memory?","created_on":"2014-09-02T07:02:59Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"787"}]},{"id":4085,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2014-09-03T11:39:15Z","details":[{"property":"attachment","name":"762","new_value":"basket7.zip"}]},{"id":4086,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"xml samples for setProduct requests and xsd : open for comments :-)","created_on":"2014-09-03T12:29:15Z","details":[{"property":"attachment","name":"764","new_value":"setproduct.xsd"},{"property":"attachment","name":"763","new_value":"setproduct-sample.xml"},{"property":"attr","name":"assigned_to_id","old_value":"787","new_value":"383"}]},{"id":4087,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"As discussed with Yves, xml should be lighter:\r\n- supplier is identified accross authentication\r\n- we don't need id *AND* guid : I propose to drop id\r\n- in the same way, we don't need id *AND* textual information (ie for state, storage...) : I propose to drop id\r\n\r\nhere is updated proposal files","created_on":"2014-09-04T06:24:27Z","details":[{"property":"attachment","name":"766","new_value":"setproduct.xsd"},{"property":"attachment","name":"765","new_value":"setproduct-sample.xml"}]},{"id":4726,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"","created_on":"2015-02-25T16:49:34Z","details":[{"property":"attr","name":"description","old_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"pricing manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"pricing manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"pricing\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Pricing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 and the \"pricing manager\" -role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the pricing manager will be able to define its entire price politic \r\nif the user can manage pricing for different organisms, the user must first choose for which organism he wants see the pricing.\r\n\r\n * first screen lists all organisms that a pricing manager is responsible for (with per organism filter); if the user is responsible of only one organism than the first screen displays automatically pricing's edition form\r\n\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a pricing profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a pricing profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all pricing information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n","new_value":"the need is to be able to calculate prices directly \"on the fly\" in the basket, before validating an order.\r\n\r\nMany impacts :\r\n\r\n*in back-end*\r\n\r\n* add a new role \"pricing manager\" in the \"user\" screen, tab \"role\" (the user can have the role in 0 to n organisms); \"pricing manager\" is an effective role related to organism and not to resource like \"diffusion manager\", \"metadata editor\", ...\r\n* in the SHOP webservice, the tarification and price calculation details must be delivered (see gliffy attachement number 4)\r\n* in the SHOP, add a new menu \"pricing\", the admin can configure the tax amount per categorie (see gliffy attachement 6); after discussion some implementation changes are validated:\r\n\r\n * cost per category is filled in category's edition form\r\n * other global parameter are integrated in SHOP options form (\"Pricing\" tab)\r\n * \"Pricing\" tab will have a message like \"Category's cost are editable in category edition form (link to categories list)\r\n\r\n* in the SHOP, add a general parameter to enable/disable the online price calculation : if set to disable, the basket remain as in easySDI V4.1 -and the \"pricing manager\" role is not available in CONTACT-\r\n\r\n*in front-end*\r\n\r\n* a new screen where the pricing manager will be able to define its entire price politic \r\nif the user can manage pricing for different organisms, the user must first choose for which organism he wants see the pricing.\r\n\r\n * first screen lists all organisms that a pricing manager is responsible for (with per organism filter); if the user is responsible of only one organism than the first screen displays automatically pricing's edition form\r\n\r\n\r\n(see gliffy screen in attachement, number 2)\r\n\r\n* in \"diffusion management\" under \"ressources\". The attribute \"tarif\" will be move under \"extraction\" and will contain the following items :\r\n1. free\r\n2. fee without a pricing profile (if set, \"Ask for estimate\" button is available inside the basket beside \"Place order\" button)\r\n3. fee with a pricing profil\r\n - profil 1\r\n - profil 2\r\n - profil ...\r\n - ...\r\n\r\n* basket will evolve with all pricing information, per data supplier (see layout in attachement basket5.zip : html example)\r\n\r\n * Perimeter selection is pushed on top of basket (because perimeter is needed for price calculation and therefore should be defined by the user at first - not mandatory but in logical order)\r\n * Basket and display logic is described in attachment : new_basket_explain.png\r\n\r\n* formula to determinate the price is attached to this issue (gliffy number 3 document)\r\n* pseudo-code for product price calculation is provided here : https://forge.easysdi.org/issues/643#note-18\r\n\r\n* *price calculation MUST be done server-side for security reasons*\r\n\r\nh2. Open questions :\r\n\r\n- how to store pricing parameters for each elements n the basket ?\r\n- which XML structure to add in the SHOP webservce to transmit prices details to providers ?\r\n"}]},{"id":4786,"user":{"id":3,"name":"Magoni Bruno"},"created_on":"2015-03-04T15:37:57Z","details":[{"property":"attr","name":"fixed_version_id","old_value":"158","new_value":"172"}]},{"id":4891,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"","created_on":"2015-03-06T13:42:37Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"}]},{"id":4908,"user":{"id":787,"name":"Villemagne J\u00e9r\u00f4me"},"notes":"","created_on":"2015-03-06T13:58:43Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"10"}]},{"id":6308,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"created_on":"2015-09-18T15:16:56Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383"}]}]}}