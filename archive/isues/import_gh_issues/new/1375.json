{
    "issue": {
        "closed": true,
        "title": "Make VAT optional",
        "created_at": "2016-10-07T07:03:30Z",
        "labels": [
            "Enhancement",
            "Redmine status : Closed",
            "Category : SHOP"
        ],
        "body": "**Original author :** Blatti Yves\n\n# Make VAT optional in easySDI SHOP\r\n\r\n## Abstract\r\n\r\neasySDI support VAT, but it is always applied :\r\n* pricing profiles are set tax excluded\r\n* VAT is always applied in the basket\r\n* fixed fee of providers are tax included\r\n* platform fees are tax included\r\n\r\nthe goal of thisenhancement is to make the VAT optionnal at the 3 levels : product, order (by provider), order (platform fee)\r\n\r\n## Mockups\r\n\r\n!{width: 50%}tva_basket_fee.png!:\/attachments\/download\/1027\/tva_basket_fee.png\r\n\r\n!{width: 50%}tva_order_fee.png!:\/attachments\/download\/1026\/tva_order_fee.png\r\n\r\n!{width: 50%}tva_profile.png!:\/attachments\/download\/1025\/tva_profile.png\r\n\r\n## Data model\r\n\r\n```\n\r\njos_sdi_organism:\r\n  fixed_fee_ti -> fixed_fee_te\r\n  ++ fixed_fee_apply_vat (bool)\r\njos_sdi_pricing_profile:\r\n  ++ apply_vat (bool)\r\njos_sdi_pricing_order:\r\n  ++ cfg_fee_apply_vat (bool)\r\n  cfg_overall_default_fee (\"ti\" -> \"te\")\r\njos_sdi_pricing_order_supplier\r\n  cfg_fixed_fee_ti -> cfg_fixed_fee_te\r\n  ++ cfg_fixed_fee_apply_vat (bool)\r\njos_sdi_pricing_order_supplier_product_profile\r\n  ++ cfg_apply_vat (bool)\r\n```\n\r\n\r\n## Config app\r\n\r\n```\n\r\n  ++overall_fee_apply_vat (bool)\r\n```\n\r\n\r\n\r\n## Price calculation changes in :basket + manual reply + WS interfaces\r\n\r\nEvery item that have VAT applied, must use an optional parameter.\r\nFor example:\r\n* Price with profile : profile parameter\r\n* Rebate by profile (category) : *????* proposition ?\r\n\r\nMake VAT optionnal and set prices TE where they're TI\r\n* Order fee by provider : use organism's pricing\r\n* Platform fee : use component parameter\r\n\r\n## XML getOrders\r\n\r\n```\n\r\n<code class=\"xml\">\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<sdi:orders \r\n    xmlns:sdi=\"http:\/\/www.easysdi.org\/2011\/sdi\" \r\n    xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.easysdi.org\/2011\/sdi\/getorders.xsd\">\r\n    <sdi:platform name=\"easySDI\" version=\"4.3.0\" serviceversion=\"4.0\"\/>\r\n    <sdi:order id=\"75\" type=\"order\" guid=\"677587e2-057f-0144-ddc1-9feca766448f\" datetimesent=\"2015-02-24T17:13:44\">\r\n        <sdi:name>order Name<\/sdi:name>\r\n        <sdi:client id=\"1\" guid=\"069bbff8-00fb-51b4-6104-d8c375d3201c\">\r\n            <!-- CLIENT DETAILS -->\r\n        <\/sdi:client>\r\n        <sdi:tierce\/>\r\n        <sdi:perimeter type=\"coordinates\" id=\"1\" alias=\"freeperimeter\" guid=\"f9305ed9-0d24-b5f4-c537-fbc3895a50de\">\r\n            <sdi:surface unit=\"m2\">561385600.00000000000000000000<\/sdi:surface>\r\n            <sdi:content>POLYGON((6.937866209971804 46.10561307495666,6.937866209971804 46.24824990785818,7.396545409126703 46.248249907858195,7.396545409126703 46.10561307495666,6.937866209971804 46.10561307495666))<\/sdi:content>\r\n        <\/sdi:perimeter>\r\n        <sdi:suppliers>\r\n            <sdi:supplier>\r\n                <sdi:organism id=\"2\" guid=\"16498811-2ecf-7454-d1b0-69074ef9486c\">\r\n                    <sdi:name><\/sdi:name>\r\n                    <sdi:acronym><\/sdi:acronym>\r\n                    <sdi:website><\/sdi:website>\r\n                    <sdi:categories\/>\r\n                    <sdi:contact>\r\n                        <!-- ADDRESS -->\r\n                    <\/sdi:contact>\r\n                    <sdi:invoice>\r\n                        <!-- ADDRESS -->\r\n                    <\/sdi:invoice>\r\n                    <sdi:delivery>\r\n                        <!-- ADDRESS -->\r\n                    <\/sdi:delivery>\r\n                <\/sdi:organism>\r\n                <sdi:pricing>\r\n                    <sdi:cfg_internal_free>false<\/sdi:cfg_internal_free>\r\n                    \r\n                    <!-- CHANGE : ti>te -->\r\n                    <sdi:cfg_fixed_fee_te>10.00<\/sdi:cfg_fixed_fee_te>\r\n                    <!-- CHANGE : new -->\r\n                    <sdi:cfg_fixed_fee_apply_vat>false<\/sdi:cfg_fixed_fee_apply_vat>       \r\n                    \r\n                    <sdi:cfg_data_free_fixed_fee>false<\/sdi:cfg_data_free_fixed_fee>\r\n                    <sdi:cal_fee_ti>10.00<\/sdi:cal_fee_ti>\r\n                <\/sdi:pricing>\r\n                <sdi:products>\r\n                    <sdi:product id=\"1\" guid=\"708e932b-81c3-2ce4-b907-ed07e61ac5f9\">\r\n                        <sdi:name>product name<\/sdi:name>\r\n                        <sdi:pricing>\r\n                            <sdi:cfg_type>profile<\/sdi:cfg_type>\r\n                            <sdi:profile id=\"1\" guid=\"288584e9-2013-6e64-c5b8-2011b78270bb\">\r\n                                <sdi:name>test<\/sdi:name>\r\n                                <sdi:cfg_fixed_fee>0.00<\/sdi:cfg_fixed_fee>\r\n                                <sdi:cfg_surface_rate unit=\"currency per km2\">10.00<\/sdi:cfg_surface_rate>\r\n                                <sdi:cfg_min_fee>10.00<\/sdi:cfg_min_fee>\r\n                                <sdi:cfg_max_fee>1000.00<\/sdi:cfg_max_fee>\r\n\r\n                                <!-- CHANGE : new -->\r\n                                <sdi:cfg_apply_vat>true<\/sdi:cfg_apply_vat>\r\n\r\n                            <\/sdi:profile>\r\n                            <sdi:cal_amount_data_te>1000<\/sdi:cal_amount_data_te>\r\n                            <sdi:cfg_pct_category_profile_discount>0.00<\/sdi:cfg_pct_category_profile_discount>\r\n                            <sdi:ind_lbl_category_profile_discount><\/sdi:ind_lbl_category_profile_discount>\r\n                            <sdi:cfg_pct_category_supplier_discount>0.00<\/sdi:cfg_pct_category_supplier_discount>\r\n                            <sdi:ind_lbl_category_supplier_discount><\/sdi:ind_lbl_category_supplier_discount>\r\n                            <sdi:cal_total_amount_te>1000<\/sdi:cal_total_amount_te>\r\n                            <sdi:cal_total_amount_ti>1080<\/sdi:cal_total_amount_ti>\r\n                        <\/sdi:pricing>\r\n                        <sdi:properties\/>\r\n                        <sdi:metadata id=\"3\" guid=\"aac65c9f-1895-ab24-053a-d91908aa9886\">\r\n                            <sdi:xml><\/sdi:xml>\r\n                            <sdi:pdf><\/sdi:pdf>\r\n                        <\/sdi:metadata>\r\n                    <\/sdi:product>\r\n                <\/sdi:products>\r\n            <\/sdi:supplier>\r\n        <\/sdi:suppliers>\r\n        <sdi:pricing>\r\n            <sdi:cfg_vat>8.00<\/sdi:cfg_vat>\r\n            <sdi:cfg_currency>CHF<\/sdi:cfg_currency>\r\n            <sdi:cfg_rounding>0.05<\/sdi:cfg_rounding>\r\n            \r\n            <!-- CHANGE : THIS VALUE WILL NOW BE TE -->\r\n            <sdi:cfg_overall_default_fee>50.00<\/sdi:cfg_overall_default_fee>\r\n            \r\n            <sdi:cfg_free_data_fee>true<\/sdi:cfg_free_data_fee>\r\n            \r\n            <!-- CHANGE : new -->\r\n            <sdi:cfg_fee_apply_vat>false<\/sdi:cfg_fee_apply_vat>\r\n            \r\n            <sdi:cal_fee_ti>50.00<\/sdi:cal_fee_ti>\r\n            <sdi:ind_lbl_category_order_fee><\/sdi:ind_lbl_category_order_fee>\r\n        <\/sdi:pricing>\r\n    <\/sdi:order>\r\n<\/sdi:orders>\r\n\r\n```\n\r\n\r\n## update XSD + service\r\n\r\n* Update service XSD\r\n* What about online versions ?\r\n* Changer service version in XML\r\n\r\n## Migration data\r\n\r\nUpdate script must take care data updates for historic orders\r\n\r\n\n\n**Fixed versions :** 4.4.4"
    },
    "comments": [
        {
            "body": "**Original author :** Van Hoecke H\u00e9l\u00e8ne \n\nTC has accepted as described.",
            "created_at": "2016-10-07T08:22:41Z"
        },
        {
            "body": "**Original author :** Blatti Yves\n\nOrder placed by ASIT VD",
            "created_at": "2016-10-14T13:30:27Z"
        },
        {
            "body": "**Original author :** M\u00e9rour Xavier\n\nPlease select SPONSOR=\"ASIT VD\" ;-)",
            "created_at": "2016-10-14T13:49:49Z"
        }
    ]
}