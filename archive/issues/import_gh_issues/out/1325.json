{"issue":{"id":1325,"project":{"id":16,"name":"easySDI"},"tracker":{"id":1,"name":"Defect"},"status":{"id":10,"name":"Closed"},"priority":{"id":4,"name":"Normal"},"author":{"id":383,"name":"Blatti Yves"},"assigned_to":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"category":{"id":15,"name":"PROXY"},"fixed_version":{"id":179,"name":"4.4.1"},"subject":"When no public policy is found, the proxy should send an HTTP 401 to ask for authentication","description":"When no public policy is found, the proxy should send an HTTP 401 to ask for authentication.\r\n\r\nWhen a user connects to a secured service, if the software clients does not send the  credentials on the first requests it will receive an OGC exception with an HTTP 200 code.\r\n\r\nLike this one: \r\n\r\n<pre>\r\nHTTP/1.1 200 OK\r\nServer: Apache-Coyote/1.1\r\neasysdi-proxy-error-occured: true\r\nLast-Modified: Tue, 10 May 2016 09:55:15 GMT\r\nExpires: Tue, 10 May 2016 10:15:15 GMT\r\nCache-Control: max-age=1200\r\nEtag: \"1462875315615\"\r\nContent-Encoding: gzip\r\nContent-Type: text/xml;charset=utf-8\r\nContent-Length: 277\r\nDate: Tue, 10 May 2016 09:55:15 GMT\r\n\r\n<?xml version='1.0' encoding='utf-8'?>\r\n\r\n<ExceptionReport xmlns=\"http://www.opengis.net/ows/2.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.opengis.net/ows/2.0 owsExceptionReport.xsd\" version=\"1.0.0\">\r\n\t<Exception exceptionCode=\"NoApplicableCode\">\r\n\t\t<ExceptionText>Error occurred during SERVICENAME service initialization : No public policy found.</ExceptionText>\r\n\t</Exception>\r\n</ExceptionReport>\r\n</pre>\r\n\r\nSome software client WILL NOT SEND credentials without having received a 401 response beforehand. (ESRI desktop suite for example, they cannot use secured WMS for now...)\r\n\r\n<pre>\r\nHTTP/1.1 401 Unauthorized\r\nServer: Apache-Coyote/1.1\r\neasysdi-proxy-error-occured: true\r\nWWW-Authenticate: Basic realm=\"EasySDI proxy service SERVICENAME\"\r\nContent-Type: text/xml;charset=utf-8\r\nContent-Length: 277\r\nDate: Tue, 10 May 2016 09:55:15 GMT\r\n\r\n<?xml version='1.0' encoding='utf-8'?>\r\n\r\n<ExceptionReport xmlns=\"http://www.opengis.net/ows/2.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.opengis.net/ows/2.0 owsExceptionReport.xsd\" version=\"1.0.0\">\r\n\t<Exception exceptionCode=\"NoApplicableCode\">\r\n\t\t<ExceptionText>Error occurred during SERVICENAME service initialization : No public policy found.</ExceptionText>\r\n\t</Exception>\r\n</ExceptionReport>\r\n</pre>\r\n\r\nI think this should be done in @OgcProxyServlet::createProxy@ and look like what is implemented in @EasySdiConfigFilter::doFilter@\r\n","start_date":"2016-05-10","done_ratio":100,"custom_fields":[{"id":2,"name":"Affected version","value":"138"}],"created_on":"2016-05-10T10:02:34Z","updated_on":"2016-06-17T08:59:48Z","closed_on":"2016-06-17T08:59:48Z","journals":[{"id":7629,"user":{"id":383,"name":"Blatti Yves"},"notes":"Could be something like:\r\n\r\n<pre>\r\n<code class=\"java\">\r\nif (((HttpServletRequest) servletRequest).getUserPrincipal() == null) {\r\n   //Spring Anonymous user is used to perform this request, but not policy defined for it\r\n   servletResponse.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\r\n   servletResponse.setHeader(\"WWW-Authenticate\", \"Basic realm=\\\"EasySDI Proxy service \" + servletName + \"\\\"\");\r\n   servletResponse.setHeader(\"easysdi-proxy-error-occured\", \"true\");\r\n   logger.error(\"Error occurred during \" + servletName + \" service initialization : No public policy found.\");\r\n   sendException(\"Error occurred during \" + servletName + \" service initialization : No public policy found.\", OWSExceptionReport.CODE_NO_APPLICABLE_CODE, \"\", HttpServletResponse.SC_OK, connector, null);\r\n   return null;\r\n}\r\n</code>\r\n</pre>","created_on":"2016-05-10T10:09:52Z","details":[]},{"id":7735,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2016-06-16T12:03:51Z","details":[{"property":"attr","name":"fixed_version_id","new_value":"182"}]},{"id":7737,"user":{"id":383,"name":"Blatti Yves"},"notes":"rev. 9850","created_on":"2016-06-17T06:32:20Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"},{"property":"attr","name":"fixed_version_id","old_value":"182","new_value":"179"}]},{"id":7738,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2016-06-17T06:32:33Z","details":[{"property":"attr","name":"done_ratio","old_value":"0","new_value":"100"}]},{"id":7746,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2016-06-17T07:10:39Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"12"}]},{"id":7759,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2016-06-17T07:11:19Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"23"}]},{"id":7771,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"created_on":"2016-06-17T08:59:48Z","details":[{"property":"attr","name":"status_id","old_value":"12","new_value":"10"}]}]}}