{"issue":{"id":1428,"project":{"id":16,"name":"easySDI"},"tracker":{"id":1,"name":"Defect"},"status":{"id":10,"name":"Closed"},"priority":{"id":4,"name":"Normal"},"author":{"id":383,"name":"Blatti Yves"},"assigned_to":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"category":{"id":20,"name":"SHOP"},"fixed_version":{"id":189,"name":"4.5.0"},"subject":"ON DELETE behavior for pricing should not always CASCADE","description":"ON DELETE behavior for pricing should not always CASCADE: \r\n\r\nThis is a simplified view of the order/diffusion/pricing tables to show (in RED) the problematic constraints. Notes under the figure.\r\n\r\n!on_delete.png!\r\n\r\n*[note1]* @jos_sdi_pricing_order_supplier_product_profile[pricing_profile_id] -> jos_sdi_pricing_profile[id]@ : Should not CASCADE, the point of the jos_sdi_pricing_order_* tables is to keep the history, even if a profile changes, or is deleted. I suggest to change to *SET NULL*.\r\n*[note2]* @jos_sdi_diffusion[pricing_profile_id] -> jos_sdi_pricing_profile[id]@ : SET NULL seems to be correct, BUT we should not be able to delete a profile if a diffusion is active (need a check in PHP)\r\n*[note3]* we should not be able to delete a @jos_sdi_diffusion@, we have to delete a resource, and there is a check in PHP, I propose to leave it as is.\r\n*[note4]* we should not be able to delete a @jos_sdi_organism@ if there is a resource attached, I propose to leave it as is.\r\n","start_date":"2017-06-23","done_ratio":100,"custom_fields":[{"id":2,"name":"Affected version","value":"172"}],"created_on":"2017-06-23T10:10:03Z","updated_on":"2017-06-27T07:44:24Z","closed_on":"2017-06-27T07:44:24Z","journals":[{"id":8223,"user":{"id":383,"name":"Blatti Yves"},"notes":"","created_on":"2017-06-23T10:10:52Z","details":[{"property":"attr","name":"category_id","new_value":"20"},{"property":"attr","name":"status_id","old_value":"1","new_value":"2"},{"property":"attr","name":"assigned_to_id","new_value":"383"},{"property":"attr","name":"fixed_version_id","new_value":"189"}]},{"id":8227,"user":{"id":383,"name":"Blatti Yves"},"notes":"Rev. 10213. Patched for note1 and note2.","created_on":"2017-06-26T12:30:43Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"},{"property":"attr","name":"done_ratio","old_value":"0","new_value":"100"}]},{"id":8232,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2017-06-26T14:26:52Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"12"}]},{"id":8238,"user":{"id":383,"name":"Blatti Yves"},"created_on":"2017-06-26T14:27:11Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"383","new_value":"23"}]},{"id":8244,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"created_on":"2017-06-27T07:44:24Z","details":[{"property":"attr","name":"status_id","old_value":"12","new_value":"10"}]}]}}