{"issue":{"id":685,"project":{"id":16,"name":"easySDI"},"tracker":{"id":1,"name":"Defect"},"status":{"id":10,"name":"Closed"},"priority":{"id":4,"name":"Normal"},"author":{"id":383,"name":"Blatti Yves"},"category":{"id":17,"name":"CATALOG"},"fixed_version":{"id":142,"name":"4.1.0"},"subject":"Wrong title of resource shown in metadata edition","description":"In metadata edition, the title shown is wrong.\r\nThis only appear if IDs are different for resource, version and metadata (and it's not the case if you start with a catalog from scratch, auto-incremented values will be the same for the 3 objects)\r\n\r\nI suppose the problem comes from:\r\nin @components\\com_easysdi_catalog\\views\\metadata\\view.html.php@ @ line 181\r\n\r\n<pre>\r\n<code class=\"php\">\r\n    public function getTitle() {\r\n        $query = $this->db->getQuery(true);\r\n\r\n        $query->select('m.id, v.name, s.value, s.id AS state, v.id as version, r.name as resource_name');\r\n        $query->from('#__sdi_version v');\r\n        $query->innerJoin('#__sdi_metadata m ON m.version_id = v.id');\r\n        $query->innerJoin('#__sdi_sys_metadatastate s ON s.id = m.metadatastate_id');\r\n        $query->innerJoin('#__sdi_resource r ON r.id = v.resource_id');\r\n        $query->where('v.resource_id = ' . $this->item->id);\r\n        $query->order('v.name DESC');\r\n\r\n        $this->db->setQuery($query);\r\n        $metadata = $this->db->loadObjectList();\r\n        \r\n        return $metadata[0];\r\n    }\r\n</code>\r\n</pre>\r\n\r\n\"$this->item\" represents a metadata, not a resource, so it sould be:\r\n\r\n<pre>\r\n<code class=\"php\">\r\n    public function getTitle() {\r\n        $query = $this->db->getQuery(true);\r\n\r\n        $query->select('m.id, v.name, s.value, s.id AS state, v.id as version, r.name as resource_name');\r\n        $query->from('#__sdi_version v');\r\n        $query->innerJoin('#__sdi_metadata m ON m.version_id = v.id');\r\n        $query->innerJoin('#__sdi_sys_metadatastate s ON s.id = m.metadatastate_id');\r\n        $query->innerJoin('#__sdi_resource r ON r.id = v.resource_id');\r\n        $query->where('m.id = ' . $this->item->id);\r\n        $query->order('v.name DESC');\r\n\r\n        $this->db->setQuery($query);\r\n        $metadata = $this->db->loadObjectList();\r\n        \r\n        return $metadata[0];\r\n    }\r\n</code>\r\n</pre>\r\n\r\nAnd I suppose we can drop the _order_ clause and use loadObject, because we should always get a single object from database (metadata is unique and linked to a single version).","done_ratio":0,"custom_fields":[{"id":2,"name":"Affected version","value":"143"}],"created_on":"2014-04-16T12:46:05Z","updated_on":"2015-09-18T15:18:10Z","closed_on":"2014-05-18T17:10:17Z","journals":[{"id":3162,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-04-25T15:54:24Z","details":[{"property":"attr","name":"status_id","old_value":"1","new_value":"2"},{"property":"attr","name":"assigned_to_id","new_value":"761"},{"property":"attr","name":"fixed_version_id","new_value":"144"}]},{"id":3181,"user":{"id":3,"name":"Magoni Bruno"},"created_on":"2014-04-25T17:27:20Z","details":[{"property":"attr","name":"fixed_version_id","old_value":"144","new_value":"142"}]},{"id":3192,"user":{"id":383,"name":"Blatti Yves"},"notes":"in sansbox: /easysdi/sandboxes/asit-vd/4.0.2/joomla/easysdi/com_easysdi_catalog","created_on":"2014-04-28T10:25:32Z","details":[]},{"id":3274,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-05-18T17:10:11Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"}]},{"id":3275,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2014-05-18T17:10:17Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"10"}]},{"id":6368,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"created_on":"2015-09-18T15:18:10Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"761"}]}]}}