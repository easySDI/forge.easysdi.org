{"issue":{"id":827,"project":{"id":16,"name":"easySDI"},"tracker":{"id":1,"name":"Defect"},"status":{"id":10,"name":"Closed"},"priority":{"id":4,"name":"Normal"},"author":{"id":16,"name":"Portier Thomas"},"category":{"id":15,"name":"PROXY"},"fixed_version":{"id":173,"name":"4.3.1"},"subject":"Bug whith CSW and filtering published metadata","description":"I configured a virtual CSW service with a rule with a filter on published metadata.\r\n\r\nWith a GET request it works. But not with a POST one, it returns always 0 metadata. If I configure the rule with \"All states\", it works.\r\n\r\nGET request : http://www.tigeo.fr/proxy/geonetwork-cat?request=GetCapabilities&service=CSW\r\n\r\nPOST params : \r\n\r\n<csw:GetRecords xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\nxmlns:dct=\"http://purl.org/dc/terms/\"\r\nxmlns:csw=\"http://www.opengis.net/cat/csw/2.0.2\"\r\nservice=\"CSW\"\r\nresultType=\"results\" startPosition=\"1\" maxRecords=\"20\"\r\nversion=\"2.0.2\"\r\noutputSchema=\"http://www.opengis.net/cat/csw/2.0.2\">\r\n<csw:Query typeNames=\"csw:Record\"\r\nxmlns:ogc=\"http://www.opengis.net/ogc\"\r\nxmlns:gml=\"http://www.opengis.net/gml\">\r\n<csw:ElementSetName>brief</csw:ElementSetName>\r\n<csw:Constraint version=\"1.1.0\">\r\n<ogc:Filter xmlns:ogc=\"http://www.opengis.net/ogc\" xmlns:gml=\"http://www.opengis.net/gml\">\r\n</ogc:Filter>\r\n</csw:Constraint>\r\n</csw:Query>\r\n</csw:GetRecords>","start_date":"2014-09-19","done_ratio":100,"custom_fields":[{"id":2,"name":"Affected version","value":"170"}],"created_on":"2014-09-19T08:04:11Z","updated_on":"2015-04-07T14:52:53Z","closed_on":"2015-04-07T14:52:53Z","journals":[{"id":4141,"user":{"id":16,"name":"Portier Thomas"},"notes":"GET request = http://www.tigeo.fr/proxy/geonetwork-cat?request=GetRecords&service=CSW&typeNames=csw%3ARecord","created_on":"2014-09-23T13:09:55Z","details":[]},{"id":4147,"user":{"id":16,"name":"Portier Thomas"},"notes":"I did not test on the correct version. sorry.","created_on":"2014-09-29T16:05:26Z","details":[{"property":"attr","name":"status_id","old_value":"1","new_value":"6"}]},{"id":5168,"user":{"id":16,"name":"Portier Thomas"},"notes":"I got this problem on the 4.2.7.\r\nI had a look in the log and I noticed that when status is set to published, the request sent to geonetwork is like : \r\n\r\n<ogc:Or>\r\n              <ogc:And>\r\n                <ogc:PropertyIsEqualTo>\r\n                  <ogc:PropertyName>metadatastate</ogc:PropertyName>\r\n                  <ogc:Literal>published</ogc:Literal>\r\n                </ogc:PropertyIsEqualTo>\r\n                <ogc:PropertyIsGreaterThanOrEqualTo>\r\n                  <ogc:PropertyName>published</ogc:PropertyName>\r\n                  <ogc:Literal>2015-03-30 16:34:23</ogc:Literal>\r\n                </ogc:PropertyIsGreaterThanOrEqualTo>\r\n              </ogc:And>\r\n            </ogc:Or>\r\n\r\nWhere PropertyIsGreaterThanOrEqualTo is set to the date of the day. That's mean that it filters on metadata published after today... Is there a reason to add this filter?","created_on":"2015-03-30T15:04:12Z","details":[{"property":"attr","name":"status_id","old_value":"6","new_value":"1"},{"property":"attr","name":"assigned_to_id","new_value":"23"},{"property":"cf","name":"2","old_value":"147","new_value":"170"}]},{"id":5169,"user":{"id":16,"name":"Portier Thomas"},"notes":"Ok I got it, the filter must be set to PropertyIsLessThanOrEqualTo. We want to expose metadata that has been published before today.","created_on":"2015-04-02T08:08:57Z","details":[]},{"id":5170,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"You're right, filter is not correct.\r\nWe have to test the state AND the published date but the comparator is not correct on this last one.","created_on":"2015-04-02T08:14:38Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"23","new_value":"16"}]},{"id":5174,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2015-04-03T08:03:07Z","details":[{"property":"attr","name":"assigned_to_id","old_value":"16"}]},{"id":5175,"user":{"id":3,"name":"Magoni Bruno"},"notes":"","created_on":"2015-04-03T08:03:40Z","details":[{"property":"attr","name":"status_id","old_value":"1","new_value":"2"},{"property":"attr","name":"assigned_to_id","new_value":"23"}]},{"id":5193,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2015-04-07T14:29:52Z","details":[{"property":"attr","name":"status_id","old_value":"2","new_value":"3"},{"property":"attr","name":"assigned_to_id","old_value":"23"},{"property":"attr","name":"fixed_version_id","new_value":"173"}]},{"id":5194,"user":{"id":23,"name":"Van Hoecke H\u00e9l\u00e8ne "},"notes":"","created_on":"2015-04-07T14:52:53Z","details":[{"property":"attr","name":"status_id","old_value":"3","new_value":"10"},{"property":"attr","name":"done_ratio","old_value":"0","new_value":"100"}]}]}}