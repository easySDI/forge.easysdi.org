{
    "issue": {
        "closed": true,
        "title": "SHOP enhance mail notifications",
        "created_at": "2015-09-24T09:00:10Z",
        "labels": [
            "Enhancement",
            "Redmine status : Closed",
            "Category : SHOP"
        ],
        "body": "**Original author :** Blatti Yves\n\nIn V4 notifications have been simplified (many fields have been removed compared to V2).\r\n\r\nSome of the fields in mails are important for users, validators and suppliers.\r\n\r\nHere are the *needs of ASIT VD for notifications* as an example, elements in %{color:green}green% are present in the V4 mails:\r\n\r\n\r\n|_.item\/event          |_.recipient (note)       |_.mail subject              |_.mail body                                |\r\n|new order             |user (order created)     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%                  |\r\n|new order             |extraction responsible   |id_order\r\n                                                  client_org_name             |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|new order             |notified users           |id_order\r\n                                                  client_org_name\r\n                                                  *note(2)*                   |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               [list]products_name *(1)*                  |\r\n|partial response\r\n (first product ready)\r\n see #1136             |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|final response\r\n (order_completed)     |user                     |id_order                    |id_order\r\n                                                                               %{color:green}order_name%\r\n                                                                               direct_access_order *(3)*                  |\r\n|new order validation  |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation done       |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected   |validation managers (TP) |id_order\r\n                                                  client_org_name             |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               client_name\r\n                                                                               client_org_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                               %{color:green}direct_access_request% *(4)* |\r\n|validation rejected\r\n (*does not exists,\r\n see #1146*)            |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               third_party_name\r\n                                                                               mandate_descr\r\n                                                                               mandate_contact\r\n                                                                               mandate_mail\r\n                                                                                direct_access_order *(3)*                |\r\n|supplier rejected\r\n (when all products are\r\n rejected by supplier)  |user                     |id_order                   |%{color:green}id_order%\r\n                                                                               order_name\r\n                                                                               direct_access_order *(3)*                 |\r\n\r\nTable notes:\r\n1) See #1150 group by suppliers\r\n2) This mail subject has currently no specific string (it's the same as the one for the extrection manager)\r\n3) This doesn't exist yet, and should be secured by unique token\r\n4) This link exists but is not secured by token, if a user knows the id of the validator he can validates his own order : #1147\r\n\r\n\r\n## Problem :\r\n\r\nThe current mailing system uses @sprintf@ mechanism, it results in a limitation of fields usable and their order.\r\nFor example:\r\n```\n\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '%s' has been sent. \\n\\n You can view it in your account on http:\/\/myeasysdi.org \\n\\n My EasySDI\"\r\n```\n\r\n\r\n## Solution proposal :\r\n\r\nWe could introduce a tag replacement system, with all elements of an order.\r\nWe can then pass the type of notification and an order id to the new mailer system.\r\nFor example the previous string could become:\r\n```\n\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http:\/\/myeasysdi.org \\n\\n My EasySDI\"\r\n```\n\r\nEasySDI admins could then override the strings in joomla and for example change it to :\r\n```\n\r\nCOM_EASYSDI_SHOP_BASKET_SEND_MAIL_CONFIRM_ORDER_BODY=\"Your order {ORDERID} name '{ORDERNAME}' has been sent. \\n\\n You can view it in your account on http:\/\/mysite.ch \\n\\n My site admins\"\r\n```\n\r\n\r\n## Notes :\r\n\r\n* We should use this change to correct some easySDI defects: #1136, #1146 and #1147\r\n* To avoid breaking previous versions of easysdi (4.2.x), we should introduce new strings for mail, but keep the content (except if )\r\n* This string mechanism should be applied to Subject and Body of the mails.\r\n* This mechanism will have to be documented in the wiki for admins\n\n**Fixed versions :** 4.4.0"
    },
    "comments": [
        {
            "body": "**Original author :** Blatti Yves\n\nNote TP: Direct access link without token auth should be proposed as an alternative.",
            "created_at": "2015-09-28T12:58:16Z"
        },
        {
            "body": "**Original author :** Van Hoecke H\u00e9l\u00e8ne \n\nTC has validated such enhancement.\r\n\r\n",
            "created_at": "2015-09-28T13:00:10Z"
        },
        {
            "body": "**Original author :** Blatti Yves\n\nrev 9372",
            "created_at": "2015-12-22T15:33:50Z"
        },
        {
            "body": "**Original author :** Blatti Yves\n\nrev 9383",
            "created_at": "2015-12-22T15:36:25Z"
        },
        {
            "body": "**Original author :** Blatti Yves\n\nDocumentation ready : https:\/\/forge.easysdi.org\/projects\/easysdi\/wiki\/4_SHOP_emails_customization",
            "created_at": "2015-12-22T15:38:19Z"
        }
    ]
}